<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Notebook</title>
      
      <meta property="og:title" content="redretep/ai">
      <meta property="og:description" content="Notebook styled AI interface.">
      
      <link rel="icon" type="image/x-icon" href="/assets/images/icons/favicon.ico">

      <!-- External Libraries -->
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css">
      <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css">
      <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Inter:wght@400;600&family=Fira+Code&display=swap" rel="stylesheet">

      <style>
         :root {
            --paper-bg: #fffef0;
            --line-color: #e0e0e0;
            --margin-color: #ffadad;
            --text-color: #2d3436;
            --accent-color: #0984e3;
            --font-hand: 'Indie Flower', cursive;
            --font-main: 'Inter', sans-serif;
         }

         @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
         }

         @keyframes ringWiggle {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(3deg); }
            75% { transform: rotate(-3deg); }
            100% { transform: rotate(0deg); }
         }

         @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(9, 132, 227, 0.4); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(9, 132, 227, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(9, 132, 227, 0); }
         }

         * { margin: 0; padding: 0; box-sizing: border-box; }

         body {
            font-family: var(--font-main);
            background-color: #dcdde1;
            background-image: radial-gradient(#95a5a6 0.5px, transparent 0.5px);
            background-size: 20px 20px;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
         }

         .container {
            width: 100%;
            max-width: 900px;
            height: 92vh;
            background: var(--paper-bg);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.1);
            border: 1px solid #bdc3c7;
            animation: fadeInUp 0.6s cubic-bezier(0.23, 1, 0.32, 1);
         }

         .container::before {
            content: "";
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--margin-color);
            z-index: 10;
            opacity: 0.5;
         }

         .spiral {
            position: absolute;
            left: -15px;
            top: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            z-index: 20;
         }

         .ring {
            width: 30px;
            height: 10px;
            background: linear-gradient(to bottom, #d1d1d1, #7f8c8d, #d1d1d1);
            border-radius: 10px;
            border: 1px solid #7f8c8d;
            transition: all 0.3s ease;
         }

         .container:hover .ring {
            animation: ringWiggle 0.5s ease-in-out infinite;
         }

         .chat-header {
            padding: 20px 40px 20px 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--line-color);
         }

         .brand {
            font-family: var(--font-hand);
            font-size: 28px;
            font-weight: 600;
            color: var(--text-color);
            transition: transform 0.3s ease;
         }
         .brand:hover { transform: scale(1.05) rotate(-2deg); }

         .selector {
            position: relative;
            cursor: pointer;
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--line-color);
            font-size: 13px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
         }
         
         .selector:hover { transform: scale(1.05); }

         .selector-options {
            opacity: 0;
            visibility: hidden;
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            width: 220px;
            background: white;
            border: 1px solid var(--line-color);
            border-radius: 8px;
            z-index: 100;
            padding: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: translateY(-10px);
            transition: all 0.3s ease;
         }

         .selector.open .selector-options {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
         }

         .selector-options div {
            padding: 10px;
            border-radius: 4px;
            transition: all 0.2s;
         }

         .selector-options div:hover { background: #f1f2f6; color: var(--accent-color); padding-left: 15px; }

         .chat-body {
            flex: 1;
            padding: 20px 40px 20px 60px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 25px;
            background-image: linear-gradient(var(--line-color) 1px, transparent 1px);
            background-size: 100% 30px;
            line-height: 30px;
            scroll-behavior: smooth;
         }

         .chat-body::-webkit-scrollbar { width: 6px; }
         .chat-body::-webkit-scrollbar-thumb { background: #bdc3c7; border-radius: 10px; }

         .message {
            max-width: 100%;
            position: relative;
            animation: fadeInUp 0.4s ease-out forwards;
         }

         .user-message {
            align-self: flex-start;
            font-family: var(--font-hand);
            font-size: 19px;
            color: #2980b9;
            padding-left: 10px;
         }

         .user-message::before {
            content: "Me:";
            font-weight: bold;
            margin-right: 10px;
            font-size: 14px;
            opacity: 0.6;
         }

         .ai-message {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed var(--line-color);
            transition: transform 0.3s ease;
         }
         .ai-message:hover { transform: translateX(5px); }

         .ai-prefix {
            font-family: var(--font-hand);
            font-weight: bold;
            color: var(--accent-color);
            display: block;
            margin-bottom: 5px;
         }

         .ai-content {
            font-size: 15px;
            line-height: 1.6;
         }

         .typing::after {
            content: "|";
            animation: blink 1s infinite;
         }

         @keyframes blink { 50% { opacity: 0; } }

         .ai-message pre {
            background: #f8f9fa !important;
            border: 1px solid var(--line-color) !important;
            border-radius: 4px;
            padding: 15px !important;
            margin: 10px 0;
            line-height: 1.4;
         }

         .regen-btn {
            background: white;
            border: 1px solid var(--line-color);
            color: #7f8c8d;
            font-size: 11px;
            padding: 5px 12px;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 15px;
            transition: all 0.2s;
         }

         .regen-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
            transform: rotate(2deg);
         }

         .chat-input-container {
            padding: 20px 40px 30px 60px;
            background: var(--paper-bg);
            border-top: 1px solid var(--line-color);
         }

         .input-wrapper {
            display: flex;
            align-items: center;
            background: white;
            border: 1px solid var(--line-color);
            border-radius: 30px;
            padding: 5px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: box-shadow 0.3s ease;
         }
         .input-wrapper:focus-within {
            box-shadow: 0 4px 20px rgba(9, 132, 227, 0.15);
            border-color: var(--accent-color);
         }

         .input-wrapper input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 12px 0;
            font-family: var(--font-main);
            font-size: 14px;
            outline: none;
         }

         .input-wrapper button {
            background: var(--accent-color);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            transition: all 0.3s ease;
         }
         .input-wrapper button:hover {
            transform: scale(1.1) rotate(10deg);
            animation: pulse 1.5s infinite;
         }

         .suggestions {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding: 5px 0;
         }

         .suggestion-chip {
            border: 1px solid var(--line-color);
            padding: 5px 15px;
            font-size: 12px;
            border-radius: 20px;
            cursor: pointer;
            background: white;
            white-space: nowrap;
            color: #7f8c8d;
            transition: all 0.2s ease;
         }
         
         .suggestion-chip:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            transform: translateY(-2px);
         }

         .socials {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
         }
         .socials a { color: #7f8c8d; font-size: 20px; transition: 0.3s; }
         .socials a:hover { color: var(--accent-color); transform: translateY(-5px); }

         @media (max-width: 600px) {
            .container { height: 100vh; border-radius: 0; }
            .spiral { display: none; }
            .container::before { left: 15px; }
            .chat-header, .chat-body, .chat-input-container { padding-left: 30px; padding-right: 20px; }
         }
      </style>
   </head>
   <body>
      <div class="container">
         <div class="spiral">
            <div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div>
            <div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div>
            <div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div>
         </div>

         <div class="chat-header">
            <div class="brand">redretep/ai</div>
            <div class="selector" id="modelSelector">
               <span id="selectedModelLabel">llama-3.1-8b-instant</span>
               <div class="selector-options">
                  <div data-value="llama-3.1-8b-instant">llama-3.1-8b-instant</div>
                  <div data-value="llama-3.3-70b-versatile">llama-3.3-70b-versatile</div>
               </div>
            </div>
         </div>
         
         <div class="chat-body" id="chatBody"></div>
         
         <div class="chat-input-container">
            <div class="suggestions" id="suggestionsContainer"></div>
            <div class="input-wrapper">
               <input type="text" id="aiInput" placeholder="Write a note..." autocomplete="off">
               <button id="sendMsg"><i class="fas fa-paper-plane"></i></button>
            </div>
         </div>
      </div>
      
      <div class="socials">
         <a href="https://github.com/redretep/ai" target="_blank"><i class="fab fa-github"></i></a>
      </div>

      <!-- Scripts -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
      <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>

      <script>
         const API_KEYS_URL = "https://groq-api-keys.pages.dev/apikeys.txt";
         let apiKeys = [];
         let apiKeyIndex = parseInt(localStorage.getItem("apiKeyIndex") || "-1", 10);
         let currentModel = "llama-3.1-8b-instant";
         let chatHistory = [];

         marked.setOptions({
            highlight: (code, lang) => Prism.languages[lang] ? Prism.highlight(code, Prism.languages[lang], lang) : code,
            breaks: true,
            gfm: true
         });

         async function initApiKeys() {
            try {
               const res = await fetch(API_KEYS_URL);
               const txt = await res.text();
               apiKeys = txt.split(/\r?\n/).map(l => l.trim()).filter(l => l);
            } catch(e) { console.error("Key fetch failed", e); }
         }

         function getNextApiKey() {
            if (!apiKeys.length) return "";
            apiKeyIndex = (apiKeyIndex + 1) % apiKeys.length;
            localStorage.setItem("apiKeyIndex", apiKeyIndex);
            return apiKeys[apiKeyIndex];
         }

         const chatBody = document.getElementById("chatBody");
         const aiInput = document.getElementById("aiInput");
         const sendMsg = document.getElementById("sendMsg");
         const modelSelector = document.getElementById("modelSelector");

         modelSelector.onclick = (e) => {
            modelSelector.classList.toggle("open");
            e.stopPropagation();
         };

         document.addEventListener('click', () => {
            modelSelector.classList.remove("open");
         });

         document.querySelectorAll(".selector-options div").forEach(opt => {
            opt.onclick = (e) => {
               currentModel = opt.dataset.value;
               document.getElementById("selectedModelLabel").innerText = currentModel;
               e.stopPropagation();
               modelSelector.classList.remove("open");
            };
         });

         function appendMessage(role, text) {
            const div = document.createElement("div");
            div.className = `message ${role === 'user' ? 'user-message' : 'ai-message'}`;
            
            if (role === 'ai') {
               const prefix = document.createElement("span");
               prefix.className = "ai-prefix";
               prefix.innerText = `Response:`;
               div.appendChild(prefix);

               const content = document.createElement("div");
               content.className = "ai-content typing";
               div.appendChild(content);
               
               if (text === "...") {
                  content.innerText = text;
               } else {
                  content.innerHTML = marked.parse(text);
                  content.classList.remove("typing");
               }

               if (text !== "...") {
                  const regenBtn = document.createElement("button");
                  regenBtn.className = "regen-btn";
                  regenBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Rewrite';
                  regenBtn.onclick = () => regenerateLast();
                  div.appendChild(regenBtn);
               }
            } else {
               div.innerText = text;
            }
            
            chatBody.appendChild(div);
            chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: 'smooth' });
            return div;
         }

         async function regenerateLast() {
            const lastUserMsg = [...chatHistory].reverse().find(m => m.role === 'user');
            if (!lastUserMsg) return;
            appendMessage("user", lastUserMsg.content);
            chatHistory.push({ role: "user", content: lastUserMsg.content });
            const aiDiv = appendMessage("ai", "...");
            await callAiApi(lastUserMsg.content, aiDiv);
         }

         async function callAiApi(query, aiDiv) {
            const aiContent = aiDiv.querySelector(".ai-content");
            NProgress.start();

            try {
               const key = getNextApiKey();
               const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                  method: "POST",
                  headers: {
                     "Authorization": `Bearer ${key}`,
                     "Content-Type": "application/json"
                  },
                  body: JSON.stringify({
                     model: currentModel,
                     messages: chatHistory.slice(-10), 
                     temperature: 0.8
                  })
               });
               const data = await response.json();
               const resultText = data.choices?.[0]?.message?.content || "[Error]";
               
               aiContent.classList.remove("typing");
               aiContent.innerHTML = marked.parse(resultText);
               Prism.highlightAllUnder(aiContent);
               
               const regenBtn = document.createElement("button");
               regenBtn.className = "regen-btn";
               regenBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Rewrite';
               regenBtn.onclick = () => regenerateLast();
               aiDiv.appendChild(regenBtn);

               chatHistory.push({ role: "assistant", content: resultText });
               
            } catch (err) {
               aiContent.classList.remove("typing");
               aiContent.innerText = "Error fetching data.";
            } finally {
               NProgress.done();
               chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: 'smooth' });
            }
         }

         async function handleChat() {
            const query = aiInput.value.trim();
            if (!query || apiKeys.length === 0) return;

            appendMessage("user", query);
            chatHistory.push({ role: "user", content: query });
            aiInput.value = "";
            
            const aiDiv = appendMessage("ai", "...");
            await callAiApi(query, aiDiv);
         }

         sendMsg.onclick = handleChat;
         aiInput.onkeydown = (e) => { if(e.key === "Enter") handleChat(); };

         const suggestions = [
            { label: "Poem about AI", value: "Write a short poem about an AI living in a notebook." },
            { label: "Coding help", value: "How do I center a div in 2024?" },
            { label: "Quick summary", value: "Summarize the benefits of handwritten notes vs digital." }
         ];

         const sugCont = document.getElementById("suggestionsContainer");
         suggestions.forEach(s => {
            const chip = document.createElement("div");
            chip.className = "suggestion-chip";
            chip.innerText = s.label;
            chip.onclick = () => { aiInput.value = s.value; handleChat(); };
            sugCont.appendChild(chip);
         });

         initApiKeys();
      </script>
   </body>
</html>
